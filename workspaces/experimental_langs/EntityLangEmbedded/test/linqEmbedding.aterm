Module(
  "linqEmbedding"
, [ Imports("primitives")
  , Entity(
      "URL"
    , [ Property("location", StringType())
      , Property("lastAcessed", Type("DateTime"))
      , Property("isActive", Type("Bool"))
      ]
    )
  , Entity("ActiveUrls", [])
  , FunctionDef(
      "getActiveUrls"
    , []
    , Some(ReturnType(Type("ActiveUrls")))
    , Block(
        [ VarDecl("urls", Type("ActiveUrls"))
        , Assign(
            VarRef("urls")
          , TinySqlExp(
              Select(
                [FieldRef("URL"), FieldRef("select"), QFieldRef("u", "location"), FieldRef("u")]
              )
            , From(QFieldRef("", "lastAccessed"))
            , Where(QFieldRef("u", "isActive"))
            )
          )
        , Return(VarRef("urls"))
        ]
      )
    )
  ]
)